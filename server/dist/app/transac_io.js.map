{"version":3,"sources":["app/transac_io.js"],"names":[],"mappings":";;;;;QASgB,IAAI,GAAJ,IAAI;;;;;;sBATE,WAAW;;uBACN,YAAY;;8BAEb,oBAAoB;;IAAlC,QAAQ;;qBACF,OAAO;;;;oBACR,MAAM;;;;sBACJ,QAAQ;;;;sBACb,QAAQ;;;;AAEf,SAAS,IAAI,CAAC,MAAM,EAAE,SAAS,EAAC;AACrC,WAAS,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,EAAE,UAAA,MAAM,EAAI;AACtC,aAAS,YAAY,CAAC,MAAM,EAAE,EAAE,EAAC;AAC/B,UAAI,OAAO,GAAG;AACV,aAAK,EAAE,MAAM,CAAC,KAAK;AACnB,YAAI,EAAE,MAAM,CAAC,IAAI,IAAI,yBAAO,MAAM,CAAC,IAAI,WAZpC,GAAG,CAYuC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE;AACrE,UAAE,EAAE,MAAM,CAAC,EAAE,IAAI,yBAAO,MAAM,CAAC,EAAE,WAb9B,GAAG,CAaiC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE;AAC/D,gBAAQ,EAAE,MAAM,CAAC,IAAI,IAAI,GAAG,GAAG,WAAW,GAAG,WAAW;OAC3D,CAAA;;AAED,cAAQ,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,OAAO,EAAE,UAAC,GAAG,EAAE,QAAQ,EAAK;AAC3D,YAAG,GAAG,EAAE,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC;AACvB,UAAE,CAAC,IAAI,EAAE,oBAAE,GAAG,CAAC,QAAQ,EAAE,UAAA,OAAO;iBAAE,OAAO,CAAC,aAAa,EAAE;SAAA,CAAC,CAAC,CAAC;OAC7D,CAAC,CAAC;KAEJ;;AAED,UAAM,CAAC,EAAE,CAAC,UAAU,EAAE,YAAY,CAAC,CAAC;AACpC,UAAM,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,IAAI,EAAE,EAAE,EAAI;AAC7B,aAAO,CAAC,GAAG,gBAAgB,CAAC;AAC7B,aAAO,CAAC,GAAG,CAAC,kBAAK,OAAO,CAAC,IAAI,EAAE,EAAC,KAAK,EAAE,CAAC,EAAC,CAAC,CAAC,CAAC;AAC5C,aAAO,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;AACf,QAAE,CAAC,IAAI,EAAE,EAAC,GAAG,EAAE,QAAQ,EAAC,CAAC,CAAC;KAC3B,CAAC,CAAC;GAEJ,CAAC,CAAA;CACH","file":"app/transac_io.js","sourcesContent":["import {Transac} from '../models';\nimport {TransacError} from '../helpers';\nimport {dmy, FMT} from '../helpers';\nimport * as transacs from '../helpers/transac';\nimport async from 'async';\nimport util from 'util';\nimport moment from 'moment';\nimport _ from 'lodash';\n\nexport function init(params, resources){\n  resources.io.on('connection', socket => {\n    function loadTransacs(params, cb){\n      let options = {\n          label: params.label\n        , from: params.from && moment(params.from, FMT).startOf('day').toDate()\n        , to: params.to && moment(params.to, FMT).startOf('day').toDate()\n        , dateMode: params.mode == 'v' ? 'valueDate' : 'createdAt'\n      }\n\n      transacs.loadAll(resources.conn, options, (err, transacs) => {\n        if(err) return cb(err);\n        cb(null, _.map(transacs, transac=>transac.toSummaryJSON()));\n      });\n\n    }\n\n    socket.on('transacs', loadTransacs);\n    socket.on('news', (data, cb) =>{\n      console.log(`===> IO.NEWS`);\n     console.log(util.inspect(data, {depth: 5}));\n     console.log(cb);\n      cb(null, {msg: 'coucou'});\n    });\n    \n  })\n}\n"],"sourceRoot":"/home/redpelicans/transacd2/server/src"}